<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>ActivityPub and WebFinger</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove" defer></script>
  <script class="remove">
    // All config options at https://respec.org/docs/
    var respecConfig = {
      specStatus: "CG-DRAFT",
      editors: [{ name: "Evan Prodromou", url: "https://evanp.me/" }, { name: "a", url: "https://trwnh.com" }],
      github: "swicg/activitypub-webfinger",
      shortName: "apwf",
      xref: "web-platform",
      group: "socialcg",
    };
  </script>
</head>

<body>
  <section id="abstract">
    <p>Identifiers in ActivityPub tend to be HTTPS URIs. The use of WebFinger (as defined in [[RFC7033]]) allows for discovery of an actor's identifier given a username and a hostname, which may be more socially salient or otherwise easier to communicate across various contexts and media. The username and hostname are resolved at the WebFinger endpoint of the hostname in order to discover a link to an actor associated with the user's account, and that actor similarly can be back-linked to the username and hostname.</p>
  </section>
  <section id="sotd">
    <p>This is required.</p>
  </section>
  <section class="informative">
    <h2>Motivation</h2>
    <p>Consider an HTTPS URI of the form <code>https://social.example/actors/9c5b94b1-35ad-49bb-b118-8e8fc24abf80</code> being used as an identifier for an actor associated with a user account. Communicating this digitally may be done by simply using the HTTPS URI as-is, as a hyperlink reference. However, communicating this verbally or in a space-constrained visual format can be difficult. WebFinger allows communicating aliases of the form <code>alyssa@social.example</code>, which are easier to work with in the previously-cited cases.</p>
    <p>Additional benefits of using WebFinger include smoothing over the differences between varying actor URI schemas. Different softwares may provide human-friendly URLs for an actor's profile, but these URLs may take several different forms:</p>
    <ul>
      <li><code>https://social.example/alyssa</code></li>
      <li><code>https://social.example/@alyssa</code></li>
      <li><code>https://social.example/~alyssa</code></li>
      <li><code>https://social.example/u/alyssa</code></li>
      <li>...and so on.</li>
    </ul>
    <p>Conventionally, people can be identified by their user@domain address, while documents can be identified by their HTTPS location.</p>
  </section>
  <section class="normative">
    <h2 id="discovery">Discovery</h2>
    <p></p>
    <section>
      <h3 id="forward-discovery">Discovery of an actor document given a WebFinger address</h3>
      <p>Given a username and hostname in the form <code>user@domain</code>:</p>
      <ol>
        <li>Construct an <code>acct:</code> URI of the form <code>acct:user@domain</code> (as defined in [[RFC7565]])</li>
        <li>Make an HTTP GET request to that hostname's WebFinger well-known endpoint, using the <code>acct:</code> URI as the value of the <code>resource</code> query parameter (as described in [[RFC7033]])</li>
      </ol>
      <p>For example, the WebFinger address <code>alyssa@social.example</code> can be resolved as a resource by making an HTTP GET request for <code>https://social.example/.well-known/webfinger?resource=acct:alyssa@social.example</code> (or <code>https://social.example/.well-known/webfinger?resource=acct:alyssa%40social.example</code> if percent-encoded). This request MUST returns a JRD (JSON Resource Descriptor, as defined in [[RFC6415]]) with <code>application/jrd+json</code> as the content type (assuming no specified <code>Accept</code> header).</p>
      <p>The WebFinger request and response may look like this:</p>
<pre class="http example" title="Sample JRD response">
GET /.well-known/webfinger?resource=acct:alyssa@social.example HTTP/1.1
Host: social.example

HTTP/1.1 200 OK
Content-Type: application/jrd+json

{
  "subject": "acct:alyssa@social.example",
  "aliases": [
    "https://social.example/@alyssa",
    "https://social.example/actors/9c5b94b1-35ad-49bb-b118-8e8fc24abf80"
  ],
  "links": [
    {
      "rel": "http://webfinger.net/rel/profile-page",
      "type": "text/html",
      "href": "https://social.example/@alyssa"
    },
    {
      "rel": "self",
      "type": "application/activity+json",
      "href": "https://social.example/actors/9c5b94b1-35ad-49bb-b118-8e8fc24abf80"
    }
  ]
}
</pre>
      <p>At this point, you can parse for the <code>href</code> of the element of <code>links</code> that has a <code>rel</code> of <code>self</code> and a <code>type</code> of either <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code> or <code>application/activity+json</code> (depending on the implementation).</p>
      <p>Due to the prevailing use of WebFinger addresses as canonical primary identifiers for users, implementations that require WebFinger for compatibility will often also deduplicate actors based on the WebFinger address. Therefore, it is generally expected that there is only one <code>self</code> link to an ActivityStreams document, in a unary relationship.</p>
    </section>
    <section>
      <h3 id="reverse-discovery">Reverse discovery of a WebFinger address given an actor document</h3>
      <p>Given an actor with an <code>id</code> and a <code>preferredUsername</code>:</p>
      <ol>
        <li>Take the hostname of the <code>id</code> to discover the WebFinger domain</li>
        <li>Combine the <code>preferredUsername</code> and the WebFinger domain in order to form a WebFinger address</li>
        <li>Verify that this WebFinger address links back to the same actor when performing discovery as described in <a href="#forward-discovery"></a>. Optionally: If the <code>subject</code> contains an <code>acct:</code> URI different from the one you constructed, perform a verification discovery against that <code>acct:</code> URI instead. (In such cases, the <code>subject</code> of the JRD denotes the expected canonical identifier.)</li>
      </ol>
    </section>
  </section>
  <section class="normative">
    <h2>Encoding</h2>
    <p>TBD</p>
  </section>
  <section class="informative">
    <h2>Security Considerations</h2>
    <p>TBD</p>
  </section>
  <section class="informative">
    <h2>Future Enhancements</h2>
    <p>The current use of WebFinger with ActivityPub could be improved in several ways:</p>
    <ul>
      <li>Back-linking an actor to a WebFinger address could be more explicit. Current use of <code>preferredUsername</code> is not ideal for constructing WebFinger addresses, and it also does not allow for expressing actual "preferred usernames". An explicit property for denoting the user's "canonical" WebFinger address would ease reverse-discovery concerns.</li>
      <li>Implementers could ease their de facto WebFinger requirements by treating WebFinger addresses purely as aliases for the actor's HTTPS identifier, rather than as the canonical identifier.</li>
      <li>WebFinger could be used to expose certain properties or qualified links more directly, skipping the resolution of the actor resource.</li>
      <li>An ActivityStreams profile of WebFinger can be defined in order to redirect or directly resolve the actor document if the <code>Accept</code> header specifies the correct media type, skipping the resolution of the JRD.</li>
    </ul>
  </section>
  <section id="conformance">
    <p>
      This is required for specifications that contain normative material.
    </p>
  </section>
</body>

</html>